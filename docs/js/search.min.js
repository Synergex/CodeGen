/*! HelpSmith Web Help System 4.0
* https://www.helpsmith.com
* Copyright (c) 2007-2024 Divcom Software */
'use strict';function arrayFindItem(a,b,c,d,e,g){"undefined"===typeof d&&(d=!1);"undefined"===typeof e&&(e=0);"undefined"===typeof g&&(g=a.length-1);for(var h=!1,f,k;e<=g;)f=e+g>>1,k=c(a[f],b),0>k?e=f+1:(g=f-1,0==k&&(h=!0,d||(e=f)));return{found:h,index:e}}function cmpStrings(a,b){return a<b?-1:a>b?1:0}const searchMatch={AllWords:0,Exact:1,Phrase:2};
function tWordIndex(a,b,c){this.index=a;this.exactMatch=b;this.indexInTerm=c;this.clone=function(){return new tWordIndex(this.index,this.exactMatch,this.indexInTerm)}}function searchResultItem(a,b){this.searchEngine=a;this.topicIndex=b;this.wordIndexes=[];this.rank=0}searchResultItem.prototype.getTopicTableInfo=function(a){return 0<=a&&a<this.searchEngine.topicTable.length?this.searchEngine.topicTable[a]:null};
searchResultItem.prototype.getTitle=function(){var a=this.getTopicTableInfo(this.topicIndex);return a?a.title||"":""};searchResultItem.prototype.getIconClass=function(){var a=this.getTopicTableInfo(this.topicIndex);return a?a.icon||"":""};searchResultItem.prototype.getRef=function(a){var b=this.getTopicTableInfo(this.topicIndex);if((b=b?b.href||"":"")&&a){var c=escape(this.getWordsStrValue());b+="?"+a+"="+c}return b};
searchResultItem.prototype.getWordsStrValue=function(){var a="";if(this.searchEngine.searchMatch==searchMatch.Phrase)for(var b=0;b<this.searchEngine.searchWords.length;b++){var c=this.searchEngine.searchWords[b];a+=c.word+"["+c.leadDelim+"]"}else for(b=0;b<this.wordIndexes.length;b++)a+=this.searchEngine.indexTable[this.wordIndexes[b].index][0]+"["+this.wordIndexes[b].indexInTerm+"]";return a};
searchResultItem.prototype.addWordIndex=function(a){var b=arrayFindItem(this.wordIndexes,a,function(c,d){return c.index-d.index});b.found?(b=this.wordIndexes[b.index],!b.exactMatch&&a.exactMatch&&(b.exactMatch=!0,b.indexInTerm=a.indexInTerm,--this.rank,this.rank+=100)):(this.wordIndexes.splice(b.index,0,a.clone()),this.rank=a.exactMatch?this.rank+100:this.rank+1)};
searchResultItem.prototype.updateRank=function(a,b){if(a.length){var c=this.getTitle();if(c){c=c.replace(/(\s+)/g," ");c=c.replace(/^\s+|\s+$/g,"");for(var d=/([^\s\.;,:()_{}"\/\\|<>!\?\[\]\-\+\*=%&@#]+)([\s\.;,:()_{}"\/\\|<>!\?\[\]\-\+\*=%&@#])?/g,e,g=[];e=d.exec(c);)g.push(e[1].toLowerCase());switch(b){case b.Phrase:c=0;e=!0;var h=a[0].word.toLowerCase(),f=0;do{f=g.indexOf(h,f);if(0>f||g.length-f-1<a.length-1){e=!1;break}var k=1;for(d=f+1;d<g.length&&k<a.length;d++,k++)if(g[d]!=a[k].word.toLowerCase()){e=
!1;break}if(e){c+=100;break}f++}while(1);e&&(a=g.length-a.length,c-=a);this.rank+=c;break;default:function r(p,n){for(var m=0;m<n.length;m++)if(p==n[m].word)return m;return-1}c=0;e=[];for(d=0;d<a.length;d++)for(h=a[d].word.toLowerCase(),k=0;k<g.length;k++)if(f=g[k],(b==b.Exact?f:f.substr(0,h.length))==h){var l=f.length==h.length;f=r(h,e);0<=f?(f=e[f],f.offs.push({value:k,exactly:l})):e.push({word:h,offs:[{value:k,exactly:l}]})}for(d=0;d<e.length;d++){f=e[d];h=!1;for(k=0;k<f.offs.length;k++)if(b=f.offs[k],
f.exactly){h=!0;break}c+=h?1E4:1E3}h=[];for(d=e.length-1;0<=d;d--)for(f=e[d],k=0;k<f.offs.length;k++)if(b=f.offs[k],d==e.length-1)l=[],l.push(b),h.push(l);else for(l=0;l<h.length;l++)b.value==h[l][0].value-1&&h[l].splice(0,0,b);function q(p){for(var n=!0,m=0;m<p.length;m++)if(!p[m].exactly){n=!1;break}return n}for(d=0;d<h.length;d++)l=h[d],a.length==l.length&&(c+=q(l)?5E4:5E3);1==h.length&&(a.length==g.length?c+=q(h[0])?1E6:5E5:(a=g.length-a.length,c-=a));this.rank+=c}}}};
function searchEngine(a,b){this.indexTable=a||[];this.topicTable=b||[];this.searchWords=[];this.searchMatch=null;this.resultItems=[]}
searchEngine.prototype.parseQuery=function(a,b){this.searchWords=[];this.actualQuery="";a=$.trim(a);var c=!1;if('"'==a.charAt(0)&&'"'==a.charAt(a.length-1)){var d=!1;c=b=!0}else"["==a.charAt(0)&&"]"==a.charAt(a.length-1)&&(d=!0,b=!1,c=!0);this.searchMatch=b?searchMatch.Phrase:d?searchMatch.Exact:searchMatch.AllWords;c&&(a=a.substring(1,a.length-1));if(0==a.length)return!1;a=a.replace(/(\s+)/g," ");a=a.replace(/^\s+|\s+$/g,"");b=/([^\s\.;,:()_{}"\/\\|<>!\?\[\]\-\+\*=%&@#]+)([\s\.;,:()_{}"\/\\|<>!\?\[\]\-\+\*=%&@#])?/g;
for(c="";d=b.exec(a);){var e={word:d[1].toLowerCase(),leadDelim:c};c=d[2]||"";this.searchWords.push(e)}this.actualQuery=a;return 0<this.searchWords.length};searchEngine.prototype.findWordPart=function(a,b){for(var c=[],d=0;d<this.indexTable.length;d++){var e=this.indexTable[d][0];"string"===typeof e&&e.substr(0,a.length)==a&&c.push(new tWordIndex(d,e.length==a.length,b))}return 0==c.length?null:c};
searchEngine.prototype.findMasterWord=function(a){a=arrayFindItem(this.indexTable,a,function(b,c){return cmpStrings(b[0],c)});return a.found?a.index:-1};searchEngine.prototype.mergePhraseIndex=function(a){if(1<a.length){for(var b=[],c=a[a.length-1],d=0;d<c.length;d++){for(var e=c[d],g=0;g<a.length-1;g++){for(var h=!1,f=0;f<a[g].length;f++)if(a[g][f]==e){h=!0;break}if(!h)break}h&&b.push(e)}return b}return 0<a.length?a[0]:null};
searchEngine.prototype.getSequenceTopicIndex=function(a,b,c){var d=!1,e=this.findMasterWord(b.word);if(0<=e){a=this.indexTable[a][2];if(Array.isArray(a))for(var g=0;g<a.length;g++){var h="string"==typeof a[g][1],f=" ";h&&(f=a[g][1]);if(a[g][0]==e&&f==b.leadDelim){h?c.push(a[g][2]):c.push(a[g][1]);d=!0;break}}d||(e=-1)}return e};
searchEngine.prototype.findPhrase=function(){for(var a=[],b=-1,c=0;c<this.searchWords.length;c++)if(0>b?(b=this.findMasterWord(this.searchWords[c].word),0<=b&&a.push(this.indexTable[b][1])):b=this.getSequenceTopicIndex(b,this.searchWords[c],a),0>b){a=[];break}if(a=this.mergePhraseIndex(a))for(c=0;c<a.length;c++)this.getResultItem(a[c])};
searchEngine.prototype.findExactWords=function(){for(var a=0;a<this.searchWords.length;a++){var b=this.findMasterWord(this.searchWords[a].word);0<=b&&this.createResultItems([new tWordIndex(b,!0,a)])}};searchEngine.prototype.findPartsOfWords=function(){for(var a=0;a<this.searchWords.length;a++){var b=this.findWordPart(this.searchWords[a].word,a);b&&this.createResultItems(b)}};
searchEngine.prototype.createResultItems=function(a){for(var b=0;b<a.length;b++)for(var c=this.indexTable[a[b].index][1],d=0;d<c.length;d++)this.getResultItem(c[d]).addWordIndex(a[b])};searchEngine.prototype.getResultItem=function(a){var b=arrayFindItem(this.resultItems,a,function(c,d){return c.topicIndex-d});if(b.found)return this.resultItems[b.index];a=new searchResultItem(this,a);this.resultItems.splice(b.index,0,a);return a};
searchEngine.prototype.findWords=function(){this.resultItems=[];switch(this.searchMatch){case searchMatch.Phrase:this.findPhrase();break;case searchMatch.Exact:this.findExactWords();break;default:this.findPartsOfWords()}return 0<this.resultItems.length};searchEngine.prototype.search=function(a,b){this.parseQuery(a,b)&&this.findWords();for(a=0;a<this.resultItems.length;a++)this.resultItems[a].updateRank(this.searchWords,this.searchMatch);return 0<this.resultItems.length};